/* ============================================
   Responsive Overrides for Mobile & iPad
   Desktop (>= 1025px) remains UNCHANGED
   ============================================ */

/* =========================
   A) Global Mobile Safety
   ========================= */
*, *::before, *::after {
  box-sizing: border-box !important;
}

/* Only apply overflow/x constraints on mobile and tablet */
@media (max-width: 1024px) {
  html, body {
    overflow-x: hidden !important;
    max-width: 100vw !important;
  }
}

/* =========================
   B) iPad / Tablet (<= 1024px)
   ========================= */
@media (max-width: 1024px) {
  /* Main page padding reduction */
  .container {
    padding: 20px 16px !important;
  }

  /* Header adjustments */
  .header h1 {
    font-size: 2.5rem !important;
    margin-bottom: 8px !important;
  }

  .header .subtitle {
    font-size: 1rem !important;
  }

  /* Main tabs - slightly smaller */
  .main-tabs {
    padding: 6px !important;
    gap: 8px !important;
  }

  .main-tab {
    padding: 10px 20px !important;
    font-size: 0.95rem !important;
  }

  /* Search area - reduce padding */
  .search-area-container .search-container {
    padding: 12px 16px !important;
  }

  .search-area-container .search-container .card-title {
    font-size: 1rem !important;
  }

  .search-area-container .search-container .card-subtitle {
    font-size: 0.8rem !important;
  }

  /* Browse & Results Grid - two columns or single column based on space */
  .browse-results-grid {
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }

  /* Remove 725px fixed width constraints */
  .browse-results-grid > .card.results-container,
  .browse-results-grid > :nth-child(2) {
    width: auto !important;
    max-width: 100% !important;
    min-width: 0 !important;
  }

  /* Cards - reduce padding for better space usage */
  .card {
    padding: 14px !important;
  }

  .card-header {
    padding: 12px 14px !important;
    margin-bottom: 10px !important;
  }

  /* Browse panels - control max-height with internal scrolling */
  .browse-ingredients-layout {
    gap: 18px !important;
  }

  .goals-chips {
    max-height: 200px !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  .subcategories-grid {
    max-height: 300px !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  .ingredients-grid-compact {
    max-height: 400px !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Selected summary - tighter spacing */
  .selected-summary {
    padding: 10px 14px !important;
    gap: 16px !important;
    margin-bottom: 16px !important;
  }

  /* Results container - ensure it fits */
  .results-container {
    width: 100% !important;
    max-width: 100% !important;
  }

  .results-container .results-body {
    padding: 14px !important;
  }

  /* Tabs - horizontal scrolling if needed */
  .main-tabs,
  .results-container .tabs,
  .tabs {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
    flex-wrap: nowrap !important;
  }

  .main-tabs > *,
  .results-container .tabs > *,
  .tabs > * {
    flex: 0 0 auto !important;
  }
}

/* =========================
   C) Mobile (<= 768px)
   ========================= */
@media (max-width: 768px) {
  /* Single column flow - enforce strict stacking */
  .browse-results-grid {
    grid-template-columns: 1fr !important;
    gap: 14px !important;
  }

  /* Container - full width, minimal padding */
  .container {
    padding: 12px 14px !important;
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
  }

  /* Header - smaller on mobile */
  .header {
    margin-bottom: 24px !important;
  }

  .header h1 {
    font-size: 2rem !important;
    margin-bottom: 6px !important;
  }

  .header .subtitle {
    font-size: 0.9rem !important;
    margin-bottom: 12px !important;
  }

  .header .badge {
    font-size: 0.8rem !important;
    padding: 6px 16px !important;
  }

  /* Main tabs container */
  .main-tabs-container {
    margin-bottom: 20px !important;
    padding: 0 4px !important;
  }

  .main-tabs {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
    white-space: nowrap !important;
    padding: 6px 2px 8px !important;
    gap: 8px !important;
    flex-wrap: nowrap !important;
  }

  .main-tabs > * {
    flex: 0 0 auto !important;
  }

  .main-tab {
    padding: 12px 16px !important;
    font-size: 0.9rem !important;
    min-height: 44px !important;
    white-space: nowrap !important;
  }

  /* Search area - full width, reduced padding */
  .search-area-container {
    padding: 0 !important;
    margin-bottom: 20px !important;
  }

  .search-area-container .search-container {
    width: 100% !important;
    max-width: 100% !important;
    padding: 12px 14px !important;
  }

  .search-area-container .search-container .card-header {
    padding: 10px 0 !important;
    margin-bottom: 10px !important;
  }

  .search-area-container .search-container .card-title {
    font-size: 0.95rem !important;
  }

  .search-area-container .search-container .card-subtitle {
    font-size: 0.8rem !important;
  }

  /* Ingredients textarea - readable on mobile */
  .search-area-container .ingredients-textarea {
    min-height: 100px !important;
    padding: 12px !important;
    font-size: 16px !important; /* Prevent iOS zoom */
    width: 100% !important;
  }

  /* Primary action button - full width, touch-friendly */
  .search-area-container .search-container #analyze-btn,
  #analyze-btn {
    width: 100% !important;
    padding: 14px 20px !important;
    font-size: 16px !important;
    min-height: 44px !important;
    margin-top: 12px !important;
  }

  /* Selected summary - stack on mobile */
  .selected-summary {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 10px !important;
    padding: 10px 12px !important;
    margin-bottom: 14px !important;
  }

  .selected-item {
    width: 100% !important;
    font-size: 0.85rem !important;
  }

  /* Browse sections - single column flow */
  .browse-ingredients-layout {
    gap: 16px !important;
  }

  /* Goals section */
  .goals-section {
    margin-bottom: 16px !important;
  }

  .section-header-compact {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 10px !important;
  }

  .section-title-compact {
    font-size: 1rem !important;
  }

  .search-input-compact {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    font-size: 16px !important; /* Prevent iOS zoom */
    padding: 10px 12px !important;
  }

  .goals-chips {
    max-height: 180px !important;
    overflow-y: auto !important;
    padding: 8px !important;
  }

  .goal-chip {
    font-size: 0.85rem !important;
    padding: 8px 14px !important;
  }

  /* Subcategories section */
  .subcategories-section {
    margin-bottom: 16px !important;
  }

  .subcategories-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
    gap: 8px !important;
    max-height: 250px !important;
    overflow-y: auto !important;
    padding: 8px !important;
  }

  /* Ingredients section */
  .ingredients-section {
    margin-bottom: 16px !important;
  }

  .ingredients-grid-compact {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
    gap: 8px !important;
    max-height: 350px !important;
    overflow-y: auto !important;
  }

  .subsection-title {
    font-size: 0.9rem !important;
    margin-bottom: 8px !important;
  }

  /* Results container - full width */
  .results-container {
    width: 100% !important;
    max-width: 100% !important;
  }

  .results-container .results-header {
    flex-wrap: wrap !important;
    gap: 10px !important;
    padding: 12px 14px !important;
  }

  .results-container .card-title {
    font-size: 1rem !important;
  }

  /* Tabs - horizontal scrolling */
  .results-container .tabs,
  .tabs {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
    white-space: nowrap !important;
    padding: 6px 2px 8px !important;
    flex-wrap: nowrap !important;
    gap: 8px !important;
  }

  .results-container .tabs > *,
  .tabs > * {
    flex: 0 0 auto !important;
  }

  .results-container .tabs .tab,
  .tabs .tab,
  .results-container .tabs button,
  .tabs button {
    padding: 10px 14px !important;
    font-size: 0.85rem !important;
    min-height: 44px !important;
    white-space: nowrap !important;
  }

  /* Results body - tighter padding */
  .results-container .results-body,
  .results-body {
    padding: 12px 14px !important;
    max-height: none !important;
    overflow-y: visible !important;
    overflow-x: auto !important;
  }

  /* Cards - smaller padding */
  .card {
    padding: 12px 14px !important;
    border-radius: 12px !important;
  }

  .card-header {
    padding: 10px 0 8px 0 !important;
    margin-bottom: 10px !important;
  }

  /* Smoothie tab adjustments */
  #smoothie-tab-content .search-container {
    padding: 12px 14px !important;
  }

  #smoothie-tab-content .search-section {
    margin-bottom: 16px !important;
  }

  #smoothie-tab-content .search-input,
  #smoothie-tab-content select {
    font-size: 16px !important; /* Prevent iOS zoom */
    padding: 10px 12px !important;
    width: 100% !important;
  }

  #smoothie-tab-content #build-smoothie-btn,
  #smoothie-tab-content #clear-smoothie-btn {
    min-height: 44px !important;
    font-size: 16px !important;
  }

  #smoothie-tab-content #build-smoothie-btn {
    width: 100% !important;
    margin-bottom: 10px !important;
  }

  #smoothie-tab-content #clear-smoothie-btn {
    width: 100% !important;
  }

  /* Smoothie presets grid */
  #smoothie-presets {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* Feedback modal - near full screen on mobile */
  #feedback-modal {
    padding: 0 !important;
  }

  #feedback-modal > div {
    width: 100% !important;
    max-width: 100% !important;
    height: 100vh !important;
    max-height: 100vh !important;
    border-radius: 0 !important;
    padding: 20px 16px !important;
  }

  /* Prevent horizontal scroll from wide content */
  .results-container .results-body table,
  .results-container .results-body pre,
  .results-container .results-body code {
    max-width: 100% !important;
    overflow-x: auto !important;
    display: block !important;
  }

  .results-container .results-body table {
    white-space: nowrap !important;
  }

  .results-container .results-body pre,
  .results-container .results-body code {
    white-space: pre-wrap !important;
    word-break: break-word !important;
    overflow-wrap: anywhere !important;
  }

  /* Allergens report wrapping */
  #allergens-results-body .pf-a-wrap {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 10px !important;
  }

  /* Smoothie builder adjustments */
  #smoothie-tab-content .main-content-grid {
    display: flex !important;
    flex-direction: column !important;
    gap: 14px !important;
  }
}

/* =========================
   D) Small Phones (<= 480px)
   ========================= */
@media (max-width: 480px) {
  /* Even tighter spacing */
  .container {
    padding: 10px 12px !important;
  }

  .header h1 {
    font-size: 1.75rem !important;
  }

  .header .subtitle {
    font-size: 0.85rem !important;
  }

  /* Main tabs - smaller */
  .main-tabs {
    gap: 6px !important;
    padding: 5px 2px 6px !important;
  }

  .main-tab {
    padding: 10px 14px !important;
    font-size: 0.85rem !important;
  }

  /* Search area - minimal padding */
  .search-area-container .search-container {
    padding: 10px 12px !important;
  }

  /* Cards - minimal padding */
  .card {
    padding: 10px 12px !important;
  }

  .card-header {
    padding: 8px 0 6px 0 !important;
  }

  /* Selected summary - tighter */
  .selected-summary {
    padding: 8px 10px !important;
    gap: 8px !important;
  }

  .selected-item {
    font-size: 0.8rem !important;
  }

  /* Browse sections - smaller grids */
  .subcategories-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)) !important;
    gap: 6px !important;
  }

  .ingredients-grid-compact {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)) !important;
    gap: 6px !important;
  }

  /* Results tabs - smaller */
  .results-container .tabs .tab,
  .tabs .tab {
    padding: 8px 12px !important;
    font-size: 0.8rem !important;
  }

  /* Results body - minimal padding */
  .results-container .results-body {
    padding: 10px 12px !important;
  }

  /* Goal chips - smaller */
  .goal-chip {
    font-size: 0.8rem !important;
    padding: 6px 12px !important;
  }

  /* Section headers */
  .section-title-compact {
    font-size: 0.95rem !important;
  }

  .subsection-title {
    font-size: 0.85rem !important;
  }
}

/* =========================
   D) Accessibility / UX
   ========================= */
@media (max-width: 768px) {
  /* Touch targets - minimum 44px height */
  button,
  .main-tab,
  .tab,
  .goal-chip,
  .btn-primary,
  #analyze-btn,
  #build-smoothie-btn,
  #clear-smoothie-btn {
    min-height: 44px !important;
    min-width: 44px !important;
  }

  /* Inputs - readable font sizes, prevent iOS zoom */
  input[type="text"],
  input[type="email"],
  input[type="search"],
  textarea,
  select {
    font-size: 16px !important;
    min-height: 44px !important;
  }

  /* Ensure text is readable */
  body,
  .card-title,
  .card-subtitle,
  .section-title-compact {
    -webkit-text-size-adjust: 100% !important;
    text-size-adjust: 100% !important;
  }
}

/* =========================
   HARD OVERRIDES (WINNERS)
   Intentionally last so they beat earlier rules.
   ========================= */

@media (max-width: 1024px) {
  /* Ingredient tab: stack Browse + Results */
  .browse-results-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 14px !important;
    align-items: start !important;
  }
  .browse-results-grid > .card {
    min-width: 0 !important;
    width: 100% !important;
  }

  /* Health goals / subcategory / ingredients: single column */
  .browse-ingredients-layout {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* Smoothie tab: stack builder + results */
  #smoothie-tab-content .main-content-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 14px !important;
  }
}

@media (max-width: 768px) {
  /* Tabs: keep one row, allow swipe */
  .main-tabs,
  .results-container .tabs {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  .main-tabs > *,
  .results-container .tabs > * {
    flex: 0 0 auto !important;
    white-space: nowrap !important;
  }

  /* Prevent sideways scroll from long tables/code */
  .results-container .results-body {
    overflow-x: auto !important;
  }
}

/* --- FIX: Health Goals chip wrapping (local) --- */
@media (max-width: 1024px) {
  /* Make goals a real grid, not wrap-based */
  #category-list {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 12px !important;
  }

  /* Force every chip to fit its column */
  #category-list .goal-chip {
    width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
    padding: 14px 12px !important;
    font-size: 1rem !important;
    line-height: 1.15 !important;
    text-align: center !important;
    white-space: normal !important; /* allow wrap inside chip, not layout wrap */
  }
}

@media (max-width: 480px) {
  #category-list {
    gap: 10px !important;
  }
  #category-list .goal-chip {
    padding: 12px 10px !important;
    font-size: 0.95rem !important;
  }
}

/* --- SUPER OVERRIDE: beat (index) rules on mobile/tablet --- */
@media (max-width: 1024px) {
  /* This targets the exact ingredient tab section, higher specificity than (index) */
  #ingredient-tab-content .browse-ingredients-layout {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* Goals chips: force 2-column grid inside the goals container */
  #ingredient-tab-content #category-list {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 12px !important;
  }

  #ingredient-tab-content #category-list .goal-chip {
    width: 100% !important;
    min-width: 0 !important;
  }
}

/* --- COMPACT: make Health Goals feel tighter on mobile --- */
@media (max-width: 768px) {
  /* tighten the whole browse card spacing */
  .browse-results-grid > .card {
    padding: 14px !important;
  }

  /* tighten goals grid spacing */
  #ingredient-tab-content #category-list {
    gap: 10px !important;
  }

  /* slightly tighter pills */
  #ingredient-tab-content #category-list .goal-chip {
    padding: 10px 10px !important;
    font-size: 0.95rem !important;
    border-radius: 18px !important;
  }

  /* tighten section title spacing if itâ€™s pushing content down */
  #ingredient-tab-content .section-title-compact {
    margin-bottom: 10px !important;
  }
}

/* --- MATCH LIVE: Health Goals pills (mobile) --- */
@media (max-width: 768px) {
  #ingredient-tab-content #category-list {
    display: flex !important;
    flex-wrap: wrap !important;
    column-gap: 8px !important;
    row-gap: 8px !important;
  }

  #ingredient-tab-content #category-list .goal-chip {
    font-size: 12.8px !important;
    padding: 6px 12px !important;

    /* keep the 2-column feel like live */
    flex: 1 1 calc(50% - 8px) !important;
    max-width: calc(50% - 8px) !important;

    width: auto !important;
    min-width: 0 !important;
    white-space: normal !important;
    line-height: 1.2 !important;
    text-align: center !important;
  }
}
